{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Mi Blog{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'blog/css/blog.css' %}?v={{ timestamp|default:'1' }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* Header minimalista */
        .blog-header { background:#fafafa; border-bottom:1px solid #ddd; position:sticky; top:0; z-index:1000; }
        .header-nav { max-width:900px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; padding:1rem; }
        .logo { font-size:1.5rem; font-weight:600; color:#333; text-decoration:none; }
        .nav-links { display:flex; list-style:none; gap:1rem; margin:0; padding:0; align-items:center; }
        .nav-links a { text-decoration:none; color:#333; font-weight:500; padding:0.5rem 1rem; }
        .nav-links a.active { border-bottom:2px solid #333; }
        .btn-crear-post-header, .btn-admin-login { border:1px solid #333; border-radius:5px; padding:0.5rem 1rem; text-decoration:none; font-weight:500; background:#f8f9fa; color:#333; }
        .btn-crear-post-header:hover { background:#e9ecef; }
        .btn-admin-login:hover { background:#e3f2fd; color:#007bff; border-color:#007bff; }
        .user-info { color:#666; font-size:0.9rem; padding:0.5rem 1rem; }
        .blog-container { max-width:900px; margin:2rem auto; padding:0 1rem; }
        .breadcrumb { margin-bottom:1rem; font-size:0.9rem; }
        .breadcrumb a { color:#333; text-decoration:none; margin-right:0.3rem; }
        .breadcrumb a:hover { text-decoration:underline; }
        @media (max-width:600px) {
            .header-nav { flex-direction:column; align-items:flex-start; gap:0.5rem; }
            .nav-links { flex-direction:column; gap:0.5rem; width:100%; }
        }
        .messages-container { margin-bottom:2rem; }
        .alert { position:relative; padding:1rem 2.5rem 1rem 1rem; margin-bottom:1rem; border-radius:8px; border:1px solid; animation:slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity:0; transform:translateY(-20px); } to { opacity:1; transform:translateY(0); } }
        .alert-success { background:#d4edda; border-color:#c3e6cb; color:#155724; }
        .alert-error { background:#f8d7da; border-color:#f1aeb5; color:#721c24; }
        .alert-warning { background:#fff3cd; border-color:#ffeaa7; color:#856404; }
        .alert-info { background:#d1ecf1; border-color:#bee5eb; color:#0c5460; }
        .close-btn { position:absolute; top:0.5rem; right:0.8rem; background:none; border:none; font-size:1.2rem; cursor:pointer; color:inherit; opacity:0.7; }
        .close-btn:hover { opacity:1; }
        .blog-footer { background:rgba(255,255,255,0.98); color:#666; text-align:center; font-family:'Roboto',Arial,sans-serif; width:100%; padding:0.4rem 0; border-top:1px solid #eee; position:fixed; bottom:0; left:0; z-index:10; font-size:0.8rem; box-shadow:0 -1px 4px rgba(0,0,0,0.05); height:40px; }
        main.blog-container { padding-bottom:60px; }
        article { border-bottom:1px solid #ddd; padding:1rem 0; }
        article h2 { margin:0 0 0.5rem 0; }
        article p { margin:0.5rem 0; }
        section div { margin:0.3rem 0; }
        section div form button { font-size:0.8rem; color:#c00; border:none; background:none; cursor:pointer; }
    </style>
</head>
<body>
    <header class="blog-header">
        <nav class="header-nav">
            <a href="{% url 'blog:post_list' %}" class="logo">Mi Blog</a>
            <ul class="nav-links">
                <li><a href="/" class="{% if request.path == '/' %}active{% endif %}">Portfolio</a></li>
                <li><a href="{% url 'blog:post_list' %}" class="{% if request.resolver_match.url_name == 'post_list' %}active{% endif %}">Inicio</a></li>
                {% if user.is_authenticated %}
                    {% if user.is_staff or user.is_superuser %}
                        <li><a href="{% url 'blog:crear_post' %}" class="btn-crear-post-header">üîí Crear Post</a></li>
                        <li><span class="user-info">Admin: {{ user.username }}</span></li>
                    {% else %}
                        <li><span class="user-info">Hola, {{ user.username }}</span></li>
                    {% endif %}
                    <li>
                        <form method="post" action="{% url 'admin:logout' %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn-admin-login" style="background:none;border:none;padding:0;font:inherit;cursor:pointer;">
                                Salir
                            </button>
                        </form>
                    </li>
                {% else %}
                    <li><a href="/admin/" class="btn-admin-login">üîë Admin Login</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    <main class="blog-container">
        {% if messages %}
            <div class="messages-container">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                        <button class="close-btn" onclick="this.parentElement.remove()">√ó</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}
        {% for post in posts %}
            <article>
                <h2>{{ post.titulo }}</h2>
                <p>{{ post.contenido }}</p>
                {% if post.imagen %}
                    <img src="{{ post.imagen.url }}" alt="{{ post.titulo }}" style="max-width:100%;">
                {% endif %}

                {% if user.is_staff or user.is_superuser %}
                    <form method="post" action="{% url 'blog:delete_post' post.pk %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit">üóëÔ∏è Eliminar post</button>
                    </form>
                {% endif %}

                <section>
                    {% for comentario in post.comentarios.all %}
                        <div>
                            <strong>{{ comentario.autor }}</strong>: {{ comentario.contenido }}
                            {% if user.is_staff or user.is_superuser %}
                                <form method="post" action="{% url 'blog:delete_comment' comentario.pk %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit">üóëÔ∏è Eliminar comentario</button>
                                </form>
                            {% endif %}
                        </div>
                    {% endfor %}
                </section>
            </article>
        {% endfor %}
        {% endblock %}
    </main>

    <footer class="blog-footer">
        <small>&copy; 2025 Mi Blog. Todos los derechos reservados.</small>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    if (alert.parentElement) {
                        alert.style.opacity = '0';
                        alert.style.transform = 'translateY(-20px)';
                        setTimeout(() => { if(alert.parentElement) alert.remove(); }, 300);
                    }
                }, 5000);
            });
        });
    </script>
</body>
</html>
